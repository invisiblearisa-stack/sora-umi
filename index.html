<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="format-detection" content="telephone=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="ソラウミ">
  <meta name="theme-color" content="#1C6EF2">
  <title>ソラウミ</title>

  <style>
    :root { --fg:#0f1c28; --muted:#667; --line:#e5e7eb }
    *{ box-sizing:border-box }
    body{
      font-family:-apple-system,BlinkMacSystemFont,"Hiragino Kaku Gothic ProN","Noto Sans JP",sans-serif;
      margin:0; padding:16px; line-height:1.6; color:var(--fg); background:#fff;
    }
    header{ padding:6px 0 10px }
    h1{ margin:0; font-size:20px }
    .sub{ margin:0; color:var(--muted); font-size:14px }
    section{ margin:20px 0; padding-bottom:6px; border-bottom:1px dashed var(--line) }
    h2{ margin:8px 0 10px; font-size:26px }
    ul{ padding-left:20px; margin:8px 0 }
    .row{ display:flex; gap:8px; align-items:center; margin:8px 0; flex-wrap:wrap }
    input, select{ flex:1; min-width:120px; padding:10px; border:1px solid #ddd; border-radius:10px }
    button{ padding:10px 14px; border-radius:10px; border:1px solid #cfd6dd; background:#fff }
    li.touchable{ padding:6px 0 } li.touchable:active{ opacity:.6 }
    .inline-btn{ margin-left:8px }
    footer{ margin-top:20px; color:#8a8f98; font-size:12px }
  </style>

  <!-- ▼ ホームアイコン：2人イラスト（画像アップ不要・互換対応） -->
  <script>
  (function(){
    try{
      const S=180, c=document.createElement('canvas'); c.width=c.height=S; const g=c.getContext('2d');

      // 角丸背景（空→畑グラデ）
      function rr(x,y,w,h,r){ g.beginPath();
        g.moveTo(x+r,y); g.lineTo(x+w-r,y); g.quadraticCurveTo(x+w,y,x+w,y+r);
        g.lineTo(x+w,y+h-r); g.quadraticCurveTo(x+w,y+h,x+w-r,y+h);
        g.lineTo(x+r,y+h); g.quadraticCurveTo(x,y+h,x,y+h-r);
        g.lineTo(x,y+r); g.quadraticCurveTo(x,y,x+r,y); g.closePath(); }
      const grad=g.createLinearGradient(0,0,0,S);
      grad.addColorStop(0,'#7fb3ff'); grad.addColorStop(0.65,'#bfe0ff');
      grad.addColorStop(0.66,'#b5d48a'); grad.addColorStop(1,'#7fb86a');
      g.fillStyle=grad; rr(0,0,S,S,36); g.fill();

      // 地面の影
      g.fillStyle='rgba(0,0,0,.06)'; g.beginPath();
      g.ellipse(S/2,S*0.82,S*0.35,S*0.08,0,0,Math.PI*2); g.fill();

      // 2人（簡易ベクタ）
      function person(cx,cy,scale,smile,bodyColor){
        g.save(); g.translate(cx,cy); g.scale(scale,scale);
        // 髪
        g.fillStyle='#6b4a34';
        g.beginPath(); g.moveTo(-28,-8); g.quadraticCurveTo(-22,22,-14,32);
        g.quadraticCurveTo(0,40,14,32); g.quadraticCurveTo(22,22,28,-8); g.closePath(); g.fill();
        // 顔
        g.fillStyle='#f4d4c2'; g.beginPath(); g.ellipse(0,8,18,20,0,0,2*Math.PI); g.fill();
        // 目
        g.fillStyle='#1c2430'; g.beginPath(); g.arc(-6,8,2.7,0,2*Math.PI); g.arc(6,8,2.7,0,2*Math.PI); g.fill();
        // 口
        g.strokeStyle='#a25b4b'; g.lineWidth=2; g.beginPath();
        if(smile){ g.arc(0,14,4,0,Math.PI,false); } else { g.moveTo(-4,14); g.lineTo(4,14); } g.stroke();
        // 麦わら帽
        g.fillStyle='#e2c27a'; g.beginPath(); g.ellipse(0,-8,30,8,0,0,2*Math.PI); g.fill();
        g.fillStyle='#d9b76a'; g.beginPath(); g.ellipse(0,-18,18,10,0,0,2*Math.PI); g.fill();
        g.fillStyle='#3b3b3b'; g.fillRect(-14,-14,28,4);
        // 胸当て
        g.fillStyle=bodyColor; g.fillRect(-12,26,24,10);
        g.restore();
      }
      person(S*0.36,S*0.52,1.0,false,'#3f7f6a'); // 左：キリッ
      person(S*0.64,S*0.52,1.0,true ,'#2f6ae6'); // 右：笑顔

      // 収穫箱
      g.fillStyle='#a87942'; g.strokeStyle='#7a542f'; g.lineWidth=2;
      g.beginPath(); g.rect(S*0.5-36,S*0.68-10,72,18); g.fill(); g.stroke();
      g.fillStyle='#e3c58b'; for(let i=-24;i<=24;i+=16){ g.beginPath(); g.arc(S*0.5+i,S*0.68-6,5,0,2*Math.PI); g.fill(); }

      // 既存 apple-touch-icon を全削除 → 新アイコンを head 先頭へ
      Array.from(document.querySelectorAll('link[rel="apple-touch-icon"]')).forEach(el=>el.remove());
      const link=document.createElement('link');
      link.rel='apple-touch-icon'; link.sizes='180x180'; link.href=c.toDataURL('image/png');
      document.head.insertBefore(link, document.head.firstChild);
    }catch(e){
      // フォールバック：青地に「ソ」
      const S=180, c=document.createElement('canvas'); c.width=c.height=S; const g=c.getContext('2d');
      g.fillStyle='#1e66ff'; g.fillRect(0,0,S,S);
      g.fillStyle='#fff'; g.font='bold 120px -apple-system, "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif';
      g.textAlign='center'; g.textBaseline='middle'; g.fillText('ソ',S/2,S/2+6);
      const link=document.createElement('link'); link.rel='apple-touch-icon'; link.sizes='180x180'; link.href=c.toDataURL('image/png');
      document.head.appendChild(link);
    }
  })();
  </script>
  <!-- ▲ アイコンここまで -->
</head>
<body>
  <header>
    <h1>ソラとウミ</h1>
    <p class="sub">就農→販売→配送までをガイド</p>
  </header>

  <!-- 1) ウミ -->
  <section>
    <h2>今日のやること（ウミ）</h2>
    <ul id="tasks"></ul>
    <div class="row">
      <input id="newTask" placeholder="例：除草（30分）">
      <button id="addTask">追加</button>
    </div>
  </section>

  <!-- 2) ソラ -->
  <section>
    <h2>販売（ソラ）</h2>
    <div class="row">
      <input id="pname"  placeholder="商品名（例：名久井米 2kg）">
      <input id="pprice" type="number" inputmode="numeric" placeholder="価格（円）">
      <input id="pstock" type="number" inputmode="numeric" placeholder="在庫(kg)">
      <button id="addProduct">商品作成</button>
    </div>
    <p id="msg"></p>
    <ul id="products"></ul>
  </section>

  <!-- 3) 受注・送り状 -->
  <section>
    <h2>受注・送り状</h2>
    <div class="row">
      <input id="cName"  placeholder="お届け先：氏名">
      <input id="cZip"   placeholder="郵便番号（例：031-0000）">
      <input id="cTel"   placeholder="電話番号">
      <input id="cAddr"  placeholder="住所（市区町村・番地・建物）">
    </div>
    <div class="row">
      <select id="cProduct"></select>
      <input id="cQty" type="number" inputmode="numeric" placeholder="数量" value="1">
      <button id="addOrder">注文追加</button>
    </div>
    <ul id="orders"></ul>
  </section>

  <footer><small>© ソラウミ</small></footer>

  <!-- ライブラリ & ロジック（変更不要） -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="./app.js"></script>
</body>
</html>
