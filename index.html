<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="format-detection" content="telephone=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="ソラウミ">
  <meta name="theme-color" content="#1C6EF2">
  <title>ソラウミ</title>

  <style>
    :root { --fg:#0f1c28; --muted:#667; --line:#e5e7eb }
    *{ box-sizing:border-box }
    body{
      font-family:-apple-system,BlinkMacSystemFont,"Hiragino Kaku Gothic ProN","Noto Sans JP",sans-serif;
      margin:0; padding:16px; line-height:1.6; color:var(--fg); background:#fff;
    }
    header{ padding:6px 0 10px }
    h1{ margin:0; font-size:20px }
    .sub{ margin:0; color:var(--muted); font-size:14px }
    section{ margin:20px 0; padding-bottom:6px; border-bottom:1px dashed var(--line) }
    h2{ margin:8px 0 10px; font-size:26px }
    ul{ padding-left:20px; margin:8px 0 }
    .row{ display:flex; gap:8px; align-items:center; margin:8px 0; flex-wrap:wrap }
    input, select{ flex:1; min-width:120px; padding:10px; border:1px solid #ddd; border-radius:10px; }
    button{ padding:10px 14px; border-radius:10px; border:1px solid #cfd6dd; background:#fff; }
    li.touchable{ padding:6px 0 } li.touchable:active{ opacity:.6 }
    .inline-btn{ margin-left:8px }
    footer{ margin-top:20px; color:#8a8f98; font-size:12px }
  </style>

  <!-- ★ ホームアイコン：2人の農作業イラスト（キャンバスで自動生成・画像アップ不要） -->
  <script>
  (function(){
    const S = 180;                // アイコンサイズ
    const c = document.createElement('canvas');
    c.width = c.height = S;
    const g = c.getContext('2d');

    // 背景（空→畑グラデ＋丸角）
    const r = 36;
    const path = new Path2D();
    path.moveTo(r,0); path.lineTo(S-r,0); path.quadraticCurveTo(S,0,S,r);
    path.lineTo(S,S-r); path.quadraticCurveTo(S,S,S-r,S);
    path.lineTo(r,S); path.quadraticCurveTo(0,S,0,S-r);
    path.lineTo(0,r); path.quadraticCurveTo(0,0,r,0);
    g.clip(path);
    const sky = g.createLinearGradient(0,0,0,S);
    sky.addColorStop(0,'#7fb3ff');   // 空
    sky.addColorStop(0.65,'#bfe0ff');
    sky.addColorStop(0.65,'#b5d48a'); // 地平
    sky.addColorStop(1,'#7fb86a');    // 畑
    g.fillStyle = sky; g.fillRect(0,0,S,S);

    // 影の円
    g.fillStyle = 'rgba(0,0,0,.06)';
    g.beginPath(); g.ellipse(S/2, S*0.82, S*0.35, S*0.08, 0, 0, Math.PI*2); g.fill();

    // 共通関数：帽子＋顔（簡易）
    function person(cx, cy, scale, mirror){
      const m = mirror ? -1 : 1;
      g.save();
      g.translate(cx, cy); g.scale(scale*m, scale);

      // 髪
      g.fillStyle = '#6b4a34';
      g.beginPath();
      g.moveTo(-28, -8); g.quadraticCurveTo(-22, 22, -14, 32);
      g.quadraticCurveTo(0, 40, 14, 32);
      g.quadraticCurveTo(22, 22, 28, -8); g.closePath(); g.fill();

      // 顔
      g.fillStyle = '#f4d4c2';
      g.beginPath(); g.ellipse(0, 8, 18, 20, 0, 0, Math.PI*2); g.fill();

      // 目
      g.fillStyle = '#1c2430';
      g.beginPath(); g.arc(-6, 8, 2.7, 0, Math.PI*2); g.arc(6, 8, 2.7, 0, Math.PI*2); g.fill();

      // 口（右の子は笑顔）
      g.strokeStyle = '#a25b4b'; g.lineWidth = 2;
      g.beginPath();
      if (mirror) { g.arc(0, 14, 4, 0, Math.PI, false); }     // 微笑
      else        { g.moveTo(-4,14); g.lineTo(4,14); }        // キリッ
      g.stroke();

      // 帽子（麦わら）
      // つば
      g.fillStyle = '#e2c27a';
      g.beginPath(); g.ellipse(0, -8, 30, 8, 0, 0, Math.PI*2); g.fill();
      // 山
      g.fillStyle = '#d9b76a';
      g.beginPath(); g.ellipse(0, -18, 18, 10, 0, 0, Math.PI*2); g.fill();
      // 黒帯
      g.fillStyle = '#3b3b3b';
      g.fillRect(-14, -14, 28, 4);

      // つなぎ（胸当て）
      g.fillStyle = mirror ? '#2f6ae6' : '#3f7f6a';
      g.fillRect(-12, 26, 24, 10);
      g.restore();
    }

    // 二人を配置（左＝ソラ、右＝ウミ）
    person(S*0.36, S*0.52, 1.0, false);
    person(S*0.64, S*0.52, 1.0, true);

    // 収穫箱
    g.save();
    g.translate(S*0.5, S*0.68);
    g.fillStyle = '#a87942'; g.strokeStyle='#7a542f'; g.lineWidth = 2;
    g.beginPath(); g.rect(-36, -10, 72, 18); g.fill(); g.stroke();
    g.fillStyle = '#e3c58b';
    for(let i=-24;i<=24;i+=16){ g.beginPath(); g.arc(i, -6, 5, 0, Math.PI*2); g.fill(); }
    g.restore();

    // link要素でホームアイコン登録
    const link = document.createElement('link');
    link.rel = 'apple-touch-icon'; link.sizes = '180x180';
    link.href = c.toDataURL('image/png');
    document.head.appendChild(link);
  })();
  </script>
</head>
<body>
  <header>
    <h1>ソラとウミ</h1>
    <p class="sub">就農→販売→配送までをガイド</p>
  </header>

  <!-- 1) ウミ：日々の作業 -->
  <section>
    <h2>今日のやること（ウミ）</h2>
    <ul id="tasks"></ul>
    <div class="row">
      <input id="newTask" placeholder="例：除草（30分）">
      <button id="addTask">追加</button>
    </div>
  </section>

  <!-- 2) ソラ：商品マスタ -->
  <section>
    <h2>販売（ソラ）</h2>
    <div class="row">
      <input id="pname"  placeholder="商品名（例：名久井米 2kg）">
      <input id="pprice" type="number" inputmode="numeric" placeholder="価格（円）">
      <input id="pstock" type="number" inputmode="numeric" placeholder="在庫(kg)">
      <button id="addProduct">商品作成</button>
    </div>
    <p id="msg"></p>
    <ul id="products"></ul>
  </section>

  <!-- 3) 受注・送り状 -->
  <section>
    <h2>受注・送り状</h2>
    <div class="row">
      <input id="cName"  placeholder="お届け先：氏名">
      <input id="cZip"   placeholder="郵便番号（例：031-0000）">
      <input id="cTel"   placeholder="電話番号">
      <input id="cAddr"  placeholder="住所（市区町村・番地・建物）">
    </div>
    <div class="row">
      <select id="cProduct"></select>
      <input id="cQty" type="number" inputmode="numeric" placeholder="数量" value="1">
      <button id="addOrder">注文追加</button>
    </div>
    <ul id="orders"></ul>
  </section>

  <footer><small>© ソラウミ</small></footer>

  <!-- ライブラリ -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="./app.js"></script>
</body>
</html>
